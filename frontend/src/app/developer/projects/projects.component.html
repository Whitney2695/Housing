<app-sidebar></app-sidebar>

<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="dashboard-title">
      <h2>My Projects</h2>
      <p>Manage all the projects you have created.</p>
    </div>
  </div>

  <div class="add-btn-container">
    <button class="add-btn" (click)="openAddModal()">
      <span class="icon">+</span> Add Project
    </button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <!-- Add Project Modal -->
  <div *ngIf="showAddModal" class="add-project-modal">
    <div class="modal-content">
      <h3>Add New Project</h3>
      <form (ngSubmit)="addProject()">
        <label for="title">Title:</label>
        <input type="text" id="title" [(ngModel)]="newProject.Title" name="Title" required />

        <label for="description">Description:</label>
        <textarea id="description" [(ngModel)]="newProject.Description" name="Description"></textarea>

        <label for="price">Price (Ksh):</label>
        <input type="number" id="price" [(ngModel)]="newProject.Price" name="Price" required />

        <label for="status">Status:</label>
        <select id="status" [(ngModel)]="newProject.Status" name="Status">
          <option>Planned</option>
          <option>Ongoing</option>
          <option>Completed</option>
        </select>

        <label for="location">Location:</label>
        <input type="text" id="location" [(ngModel)]="newProject.Location" name="Location" required />

        <!-- Separate Latitude & Longitude -->
        <label for="latitude">Latitude:</label>
        <input type="text" id="latitude" [(ngModel)]="newProject.Latitude" name="Latitude" required />

        <label for="longitude">Longitude:</label>
        <input type="text" id="longitude" [(ngModel)]="newProject.Longitude" name="Longitude" required />

        <label for="image">Project Image:</label>
        <input type="file" id="image" (change)="onFileSelected($event)" accept="image/*" />
        <img *ngIf="newProject.ProjectImage" [src]="newProject.ProjectImage" alt="Project Preview" class="preview-img" />

        <div class="button-container">
          <button type="submit" class="save-btn">Add Project</button>
          <button type="button" class="close-btn" (click)="closeAddModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Projects Table -->
  <div class="table-container">
    <table class="projects-table">
      <thead>
        <tr>
          <th>Image</th>
          <th>Title</th>
          <th>Status</th>
          <th>Price (Ksh)</th>
          <th>Location</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of projects">
          <td><img [src]="project.ProjectImageUrl" alt="Project Image" class="project-img" /></td>
          <td>{{ project.Title }}</td>
          <td>{{ project.Status }}</td>
          <td>{{ project.Price | number }}</td>
          <td>{{ project.Location }}</td>
          
          <td>
            <button class="view-btn" (click)="openViewModal(project)">
              <i class="fas fa-eye"></i> View
            </button>
            <button class="edit-btn" (click)="openEditModal(project)">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="delete-btn" (click)="openDeleteModal(project)">
              <i class="fas fa-trash"></i> Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- View Project Modal -->
<div *ngIf="selectedProject" class="modal">
  <div class="modal-content">
    <h3>{{ selectedProject.Title }}</h3>
    <p><strong>Description:</strong> {{ selectedProject.Description }}</p>
    <p><strong>Status:</strong> {{ selectedProject.Status }}</p>
    <p><strong>Price:</strong> Ksh {{ selectedProject.Price | number }}</p>
    <p><strong>Location:</strong> {{ selectedProject.Location }}</p>
    <p><strong>Latitude:</strong> {{ selectedProject.Latitude }}</p>
    <p><strong>Longitude:</strong> {{ selectedProject.Longitude }}</p>
    <button class="close-btn" (click)="closeViewModal()">Close</button>
  </div>
</div>

<!-- Edit Project Modal -->
<div *ngIf="editProjectData" class="edit-modal">
  <div class="modal-content">
    <h3>Edit Project</h3>
    <form (ngSubmit)="updateProject()">
      <label>Title:</label>
      <input type="text" [(ngModel)]="editProjectData.Title" name="Title" required>

      <label>Description:</label>
      <textarea [(ngModel)]="editProjectData.Description" name="Description"></textarea>

      <label>Price (Ksh):</label>
      <input type="number" [(ngModel)]="editProjectData.Price" name="Price" required>

      <label>Status:</label>
      <select [(ngModel)]="editProjectData.Status" name="Status">
        <option>Planned</option>
        <option>Ongoing</option>
        <option>Completed</option>
      </select>

      <label>Location:</label>
      <input type="text" [(ngModel)]="editProjectData.Location" name="Location" required>

      <!-- Separate Latitude & Longitude -->
      <label>Latitude:</label>
      <input type="text" [(ngModel)]="editProjectData.Latitude" name="Latitude" required>

      <label>Longitude:</label>
      <input type="text" [(ngModel)]="editProjectData.Longitude" name="Longitude" required>

      <div class="button-container">
        <button type="submit" class="save-btn">Save Changes</button>
        <button type="button" class="close-btn" (click)="closeEditModal()">Cancel</button>
      </div>
      
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="deleteProjectData" class="modal">
  <div class="modal-content">
    <p>Are you sure you want to delete <strong>{{ deleteProjectData.Title }}</strong>?</p>
    <button class="delete-btn" (click)="confirmDelete()">Yes, Delete</button>
    <button class="close-btn" (click)="closeDeleteModal()">Cancel</button>
  </div>
</div>
